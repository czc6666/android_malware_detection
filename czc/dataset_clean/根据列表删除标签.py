# å¯¼å…¥å¿…è¦çš„åº“
import os

# è®¾ç½®æ–‡ä»¶è·¯å¾„
invalid_apks_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/error_apks.txt'  # æ— æ•ˆçš„apkæ–‡ä»¶å
dataset_dir = '/home/czc/code/Android_Malware_Detection/dataset/czc_dataset_7'  # æ•°æ®é›†ç›®å½•
labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_labels.txt'  # æ€»æ ‡ç­¾æ–‡ä»¶
train_labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_train.filelist'  # è®­ç»ƒé›†æ ‡ç­¾æ–‡ä»¶
test_labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_labels.txt'  # æµ‹è¯•é›†æ ‡ç­¾æ–‡ä»¶

# è¯»å–æ— æ•ˆçš„ APK æ–‡ä»¶å
with open(invalid_apks_file, 'r') as file:
    invalid_apks = {line.strip() for line in file}

# åˆ é™¤æ•°æ®é›†ä¸­çš„æ— æ•ˆ APK æ–‡ä»¶
for apk in invalid_apks:  # éå†æ— æ•ˆçš„apkæ–‡ä»¶å
    apk_path = os.path.join(dataset_dir, apk)  # æ„å»ºapkæ–‡ä»¶è·¯å¾„
    if os.path.exists(apk_path):  # å¦‚æœapkæ–‡ä»¶å­˜åœ¨
        os.remove(apk_path)  # åˆ é™¤apkæ–‡ä»¶
        print(f"Deleted {apk_path}")  # æ‰“å°åˆ é™¤çš„apkæ–‡ä»¶è·¯å¾„

print("ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªæ¸…æ‰äº†æ— æ•ˆçš„apkæ–‡ä»¶ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ª")

# å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ¸…ç†æ ‡ç­¾æ–‡ä»¶
def clean_labels_file(file_path, invalid_apks):  # å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ¸…ç†æ ‡ç­¾æ–‡ä»¶
    with open(file_path, 'r') as file:  # æ‰“å¼€æ ‡ç­¾æ–‡ä»¶
        lines = file.readlines()  # è¯»å–æ ‡ç­¾æ–‡ä»¶çš„æ‰€æœ‰è¡Œ
    with open(file_path, 'w') as file:  # æ‰“å¼€æ ‡ç­¾æ–‡ä»¶
        for line in lines:  # éå†æ ‡ç­¾æ–‡ä»¶çš„æ¯ä¸€è¡Œ
            if not any(invalid_apk in line for invalid_apk in invalid_apks):  # å¦‚æœè¡Œä¸­ä¸åŒ…å«æ— æ•ˆçš„apkæ–‡ä»¶å
                file.write(line)  # å†™å…¥è¡Œ

# æ¸…ç†æ€»æ ‡ç­¾æ–‡ä»¶ã€è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ ‡ç­¾æ–‡ä»¶
clean_labels_file(labels_file, invalid_apks)  # æ¸…ç†æ€»æ ‡ç­¾æ–‡ä»¶
clean_labels_file(train_labels_file, invalid_apks)  # æ¸…ç†è®­ç»ƒé›†æ ‡ç­¾æ–‡ä»¶
clean_labels_file(test_labels_file, invalid_apks)  # æ¸…ç†æµ‹è¯•é›†æ ‡ç­¾æ–‡ä»¶

print("ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªæ¸…æ‰äº†æ— æ•ˆçš„æ ‡ç­¾æ–‡ä»¶ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ª")
