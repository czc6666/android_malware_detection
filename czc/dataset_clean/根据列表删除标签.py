# 导入必要的库
import os

# 设置文件路径
invalid_apks_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/error_apks.txt'  # 无效的apk文件名
dataset_dir = '/home/czc/code/Android_Malware_Detection/dataset/czc_dataset_7'  # 数据集目录
labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_labels.txt'  # 总标签文件
train_labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_train.filelist'  # 训练集标签文件
test_labels_file = '/home/czc/code/Android_Malware_Detection/code/android_malware_detection/data/czc_dataset_7_labels.txt'  # 测试集标签文件

# 读取无效的 APK 文件名
with open(invalid_apks_file, 'r') as file:
    invalid_apks = {line.strip() for line in file}

# 删除数据集中的无效 APK 文件
for apk in invalid_apks:  # 遍历无效的apk文件名
    apk_path = os.path.join(dataset_dir, apk)  # 构建apk文件路径
    if os.path.exists(apk_path):  # 如果apk文件存在
        os.remove(apk_path)  # 删除apk文件
        print(f"Deleted {apk_path}")  # 打印删除的apk文件路径

print("🤪🤪🤪🤪🤪清掉了无效的apk文件🤪🤪🤪🤪🤪")

# 定义一个函数来清理标签文件
def clean_labels_file(file_path, invalid_apks):  # 定义一个函数来清理标签文件
    with open(file_path, 'r') as file:  # 打开标签文件
        lines = file.readlines()  # 读取标签文件的所有行
    with open(file_path, 'w') as file:  # 打开标签文件
        for line in lines:  # 遍历标签文件的每一行
            if not any(invalid_apk in line for invalid_apk in invalid_apks):  # 如果行中不包含无效的apk文件名
                file.write(line)  # 写入行

# 清理总标签文件、训练集和测试集标签文件
clean_labels_file(labels_file, invalid_apks)  # 清理总标签文件
clean_labels_file(train_labels_file, invalid_apks)  # 清理训练集标签文件
clean_labels_file(test_labels_file, invalid_apks)  # 清理测试集标签文件

print("🤪🤪🤪🤪🤪清掉了无效的标签文件🤪🤪🤪🤪🤪")
