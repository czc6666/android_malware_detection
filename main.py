# coding=utf-8
import os
import time
from multiprocessing import Pool
import sys

# é…ç½®ç±»
from static import get_apk_path, get_lsi_config, get_xgboost_config, get_cscg_config, get_graph_config
from static import total_process_multi_core, total_process_single_core, java_src_tmp_path, ts_max, min_k_tmp_file
from static import get_dataset_name

# åŠŸèƒ½ç±» è¯æ³•åˆ†æã€æƒé™æå–ã€æ–‡ä»¶åˆ—è¡¨ç”Ÿæˆ  2.py
from lexical_analysis.extract_token import extract_token
from Permission.permissionExtract import extractPermission
from dataset_construct.create_filelist import create_filelist

# æ¨¡å‹è®­ç»ƒç±» lsi å’Œ xgboost  3.py
from lsi.lsi import lsi_train, lsi_test
from xgb_classification.combine_lsi_permission import combine_lsi_permission
from xgb_classification.xgboost_clf import train_xgb_model, test_xgb_model

# cscgå›¾æ„å»ºç±» 4.py
from lsi.lsi import lsi_train, lsi_test_cscg
from CSCG.calculate_min_k import calculate_min_k
from CSCG.java_graph import get_cscg_dataset
from GAT.create_graph_dataset import create_graph_files

# å›¾ç¥ç»ç½‘ç»œç±» 5.py
from GAT.graph_net import graph_model

# å¼‚å¸¸æ•°æ®é›†æ¸…ç†ç±»
from czc.dataset_clean.clean_label_from_apkset import clean_label

# å·¥å…·ç±»
from Decompilation.apktool import apktool
from Decompilation.jar2java import jar2java
from czc.fun_timer import fun_timer, fun_timer_dict
program_root = os.getcwd()

# æ·»åŠ apktoolçš„ç¯å¢ƒå˜é‡
os.environ["PATH"] = program_root + '/tools/apktool/' + ":" + os.environ["PATH"]
# æ·»åŠ jadxçš„ç¯å¢ƒå˜é‡
os.environ["PATH"] = program_root + '/tools/jadx/build/jadx/bin/' + ":" + os.environ["PATH"]


# ç»Ÿè®¡æ¯ä¸ªå‡½æ•°è¿è¡Œæ—¶é—´çš„å­—å…¸
function_run_time_dict = {}


# å¯¹åŸå§‹APKæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬åç¼–è¯‘ç­‰
@fun_timer_dict(function_run_time_dict)
def preproces(dataset):

    print('ğŸ”ğŸ”ğŸ”ğŸ”ğŸ”å¼€å§‹æ¸…ç†æ ‡ç­¾æ–‡ä»¶')
    time.sleep(2)
    clean_label(dataset)
    print('ğŸ”ğŸ”ğŸ”ğŸ”ğŸ”æ¸…ç†æ ‡ç­¾æ–‡ä»¶å®Œæˆ')

    apk_path, manifest_path, dex_path, java_path, _3rd_path, permission_path, token_path, filelist_train, filelist_test, filelist_train_filter, filelist_test_filter = get_apk_path(dataset)

    # 2.ä½¿ç”¨apktoolè·å–æ¯ä¸ªæ–‡ä»¶çš„Androidmanifest.xmlå’Œclass.dex,åœ¨python2.7ä¸‹è¿è¡Œ
    # æå–xmlå’Œdex
    apktool(apk_path, manifest_path, dex_path, total_process_multi_core)

    # 3.ä½¿ç”¨jadxå¯¹æ¯ä¸ªclass.dexè¿›è¡Œåç¼–è¯‘ï¼Œå¹¶å°†åç¼–è¯‘çš„å…¨éƒ¨javaæ–‡ä»¶æ‰“åŒ…ç”Ÿæˆ.zipçš„å‹ç¼©åŒ…,åœ¨python3.6ä¸‹è¿è¡Œ
    # åç¼–è¯‘dexå‡ºjavaä»£ç æ‰“åŒ…æˆzip
    jar2java(dex_path, java_path, java_src_tmp_path, program_root, total_process_multi_core)

    '''
    åœ¨DirAndFile.extractTokenæ–¹æ³•ä¸­ï¼Œå¯¹äºæ¯ä¸ªJavaæ–‡ä»¶ï¼Œå®ƒé¦–å…ˆä½¿ç”¨FileUtil.readFileè¯»å–æ–‡ä»¶å†…å®¹ï¼Œ
    ç„¶ååˆ›å»ºä¸€ä¸ªTestLexerå®ä¾‹ï¼Œå¹¶è°ƒç”¨analyseæ–¹æ³•æ¥æå–tokensã€‚
    æå–çš„tokensè¢«å­˜å‚¨åœ¨DirAndFile.tokenResultåˆ—è¡¨ä¸­ï¼Œæœ€åè¿™äº›tokenså¯ä»¥è¢«å†™å…¥åˆ°ä¸€ä¸ªç»“æœæ–‡ä»¶ä¸­ã€‚
    '''
    # 4.å¯¹æ¯ä¸ªåç¼–è¯‘å¾—åˆ°çš„javaæ–‡ä»¶è¿›è¡Œtokenæå–,åœ¨python3.6ä¸‹è¿è¡Œ
    # æå–tokenï¼Œtokenä¹Ÿå«è¯æ³•å•å…ƒï¼Œé€šå¸¸åŒ…æ‹¬å…³é”®å­—ã€æ ‡è¯†ç¬¦ã€å¸¸æ•°ã€è¿ç®—ç¬¦ç­‰ã€‚
    extract_token(dataset, _3rd_path, java_path, manifest_path, token_path, total_process_single_core)

    # 5.å¯¹æ¯ä¸ªmanifestæ–‡ä»¶æå–æƒé™ç‰¹å¾,åœ¨python3.6ä¸‹è¿è¡Œ
    # æå–xmlçš„æƒé™ç‰¹å¾ï¼Œ59ç»´æƒé™ç‰¹å¾
    extractPermission(manifest_path, permission_path)

    # 6.ç”Ÿæˆè®°å½•æ¯ä¸ªæ•°æ®é›†ä¸‹å…¨éƒ¨æœ‰æ•ˆæ•°æ®çš„æ–‡ä»¶filelist.txt,åœ¨python3.6ä¸‹è¿è¡Œï¼ˆç‹—å±ä¸é€šï¼‰
    # ğŸ˜¥åˆ›å»ºè¿‡æ»¤ï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰åçš„æ–‡ä»¶åˆ—è¡¨ã€‚ã€‚6.ä¸ºè®­ç»ƒæ•°æ®é›†ç”ŸæˆåŒ…å«æ‰€æœ‰æœ‰æ•ˆæ•°æ®æ–‡ä»¶è·¯å¾„çš„filelist.txtæ–‡ä»¶ï¼ˆczcçš„æ³¨é‡Šï¼‰
    create_filelist(filelist_train, filelist_train_filter, _3rd_path, manifest_path, java_path)

    # 7.ç”Ÿæˆè®°å½•æ¯ä¸ªæ•°æ®é›†ä¸‹å…¨éƒ¨æœ‰æ•ˆæ•°æ®çš„æ–‡ä»¶filelist.txt,åœ¨python3.6ä¸‹è¿è¡Œï¼ˆç‹—å±ä¸é€šï¼‰
    # 7.ä¸ºæµ‹è¯•æ•°æ®é›†ç”ŸæˆåŒ…å«æ‰€æœ‰æœ‰æ•ˆæ•°æ®æ–‡ä»¶è·¯å¾„çš„filelist.txtæ–‡ä»¶ï¼ˆczcçš„æ³¨é‡Šï¼‰
    create_filelist(filelist_test, filelist_test_filter, _3rd_path, manifest_path, java_path)


# ä»…ä½¿ç”¨è¯­ä¹‰æ¨¡å‹å’Œpermissionç‰¹å¾è¿›è¡Œæ¨¡å‹è®­ç»ƒ
@fun_timer_dict(function_run_time_dict)
def lsi_model_train(dataset):
    # 8.è·å–lsiæ¨¡å‹è®­ç»ƒæ‰€éœ€å…¨éƒ¨æ–‡ä»¶çš„è·¯å¾„
    train_file, test_file, TFIDF_dict_path, dict_corpus, TFIDF_model_path, TFIDF_corpus_path, LSI_model_path, LSI_corpus_path, LSI_corpus_path_test, token_root, apktool_root_path, no_below, no_above = get_lsi_config(dataset)

    # 9.è¿›è¡ŒLSIæ¨¡å‹çš„è®­ç»ƒï¼Œå†…éƒ¨åŒ…å«TFIDFæ¨¡å‹çš„è®­ç»ƒï¼Œå¹¶ç”Ÿæˆè®­ç»ƒç‰¹å¾æ–‡ä»¶
    lsi_train(dataset, train_file, TFIDF_dict_path, dict_corpus, TFIDF_model_path, TFIDF_corpus_path, LSI_model_path, LSI_corpus_path, token_root, no_below=no_below, no_above=no_above)

    # 10.ç”Ÿæˆæµ‹è¯•é›†çš„ç‰¹å¾å‘é‡
    lsi_test(dataset, test_file, TFIDF_dict_path, TFIDF_model_path, LSI_model_path, LSI_corpus_path_test, token_root)

    # 11.è·å–æ•°æ®é›†ä¸æ¨¡å‹çš„ç›¸å…³ä¿¡æ¯
    LSI_Permission_file, LSI_Permission_file_test, lsi_per_xgboost_model, LSI_corpus_path, LSI_corpus_path_test, permission_dir_path = get_xgboost_config(dataset)

    # 12.ç”Ÿæˆlsiå’Œpermissionæ‹¼æ¥åè®­ç»ƒé›†çš„ç‰¹å¾
    combine_lsi_permission(dataset, LSI_corpus_path, permission_dir_path, LSI_Permission_file)

    # 13.ç”Ÿæˆæµ‹è¯•é›†çš„lsiä¸permissionæ‹¼æ¥ç‰¹å¾
    combine_lsi_permission(dataset, LSI_corpus_path_test, permission_dir_path, LSI_Permission_file_test)

    # 14.è®­ç»ƒXGBoostæ¨¡å‹è¿›è¡Œåˆ†ç±»
    train_xgb_model(LSI_Permission_file, lsi_per_xgboost_model)

    # 15.æµ‹è¯•XGBoostæ¨¡å‹çš„æ•ˆæœ
    test_xgb_model(LSI_Permission_file_test, lsi_per_xgboost_model)


# åŸºäºjavaæ–‡ä»¶çš„importå…³ç³»è¿›è¡Œå›¾æ„å»ºï¼Œç›¸å½“äºpublic classçš„è°ƒç”¨å…³ç³»ï¼Œå¹¶ä¿ç•™ä¸€å®šçš„3rdåº“ï¼Œä½¿å¾—è¿‡æ»¤åèŠ‚ç‚¹æ•°é‡å°äº100çš„ï¼Œå°½é‡è¡¥å……åˆ°æ¥è¿‘100
@fun_timer_dict(function_run_time_dict)
def class_set_call_graph(dataset):
    # dataset_name æ•°æ®é›†çš„åç§°,
    # java_path åŸå§‹javaä»£ç å‹ç¼©åŒ…çš„å­˜æ”¾è·¯å¾„,
    # java_graph_path ä¿å­˜class-set call graphè°ƒç”¨å…³ç³»çš„è·¯å¾„,
    # _3rd_path ä¸‰æ–¹åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„,
    # token_file_root ä¿å­˜æ¯ä¸ªclass-setçš„æ­¤æ³•åˆ†æå¾—åˆ°çš„tokens,
    # min_k è¯¥æ•°æ®é›†ä¸‹çš„min_kå€¼

    # 16.è·å–CSCGçš„é…ç½®ä¿¡æ¯
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£16.è·å–CSCGçš„é…ç½®ä¿¡æ¯")
    time.sleep(3)
    java_path, java_graph_path, _3rd_path, token_file_root= get_cscg_config(dataset)
    train_file, test_file, TFIDF_dict_path, dict_corpus, TFIDF_model_path, TFIDF_corpus_path, LSI_model_path, LSI_corpus_path, LSI_corpus_path_test, token_root, apktool_root_path, no_below, no_above = get_lsi_config(dataset, type='cscg')

    # 17.è®¡ç®—min_k
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£17.è®¡ç®—min_k")
    time.sleep(3)
    min_k = calculate_min_k(dataset, java_path, train_file, ts_max, min_k_tmp_file)

    # 18.è®¡ç®—CSCGè°ƒç”¨å›¾ï¼Œå¹¶å¯¹èŠ‚ç‚¹è¿›è¡Œåˆ†è¯
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£18.è®¡ç®—CSCGè°ƒç”¨å›¾ï¼Œå¹¶å¯¹èŠ‚ç‚¹è¿›è¡Œåˆ†è¯")
    time.sleep(3)
    get_cscg_dataset(dataset, java_path, java_graph_path, _3rd_path, token_file_root, min_k=min_k, total_process=total_process_single_core)

    # æå–class-setçš„LSIå‘é‡ï¼Œæ¯ä¸ªAPKä¿å­˜æˆä¸€ä¸ªæ–‡ä»¶
    # pool = Pool(processes=2)
    # 19.ç”Ÿæˆè®­ç»ƒé›†çš„èŠ‚ç‚¹ç‰¹å¾å‘é‡
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£19.ç”Ÿæˆè®­ç»ƒé›†çš„èŠ‚ç‚¹ç‰¹å¾å‘é‡ trainâ—trainâ—trainâ—")
    time.sleep(3)
    lsi_test_cscg(dataset, train_file, TFIDF_dict_path, TFIDF_model_path, LSI_model_path, LSI_corpus_path, token_root, type='cscg')
    # pool.apply_async(lsi_test_cscg, (dataset, train_file, TFIDF_dict_path, TFIDF_model_path, LSI_model_path, LSI_corpus_path, token_root, 'cscg'))

    # 20.ç”Ÿæˆæµ‹è¯•é›†çš„èŠ‚ç‚¹ç‰¹å¾å‘é‡
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£20.ç”Ÿæˆæµ‹è¯•é›†çš„èŠ‚ç‚¹ç‰¹å¾å‘é‡ testâ—testâ—testâ—")
    time.sleep(3)
    lsi_test_cscg(dataset, test_file, TFIDF_dict_path, TFIDF_model_path, LSI_model_path, LSI_corpus_path_test, token_root, type='cscg')
    # pool.apply_async(lsi_test_cscg, (dataset, test_file, TFIDF_dict_path, TFIDF_model_path, LSI_model_path, LSI_corpus_path_test, token_root, 'cscg'))
    # pool.close()
    # pool.join()

    # é˜²æ­¢å¤šæ¬¡è°ƒå‚æ—¶ï¼Œè¯»å–ç¢æ–‡ä»¶å¤ªè€—æ—¶é—´ï¼Œå› æ­¤å…ˆå°†CSCGä¿å­˜æˆå¤§æ–‡ä»¶
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£é˜²æ­¢å¤šæ¬¡è°ƒå‚æ—¶ï¼Œè¯»å–ç¢æ–‡ä»¶å¤ªè€—æ—¶é—´ï¼Œå› æ­¤å…ˆå°†CSCGä¿å­˜æˆå¤§æ–‡ä»¶")
    time.sleep(3)
    # pool = Pool(processes=2)

    # 21.è¯»å–PSCNçš„è¾“å…¥graphæºæ–‡ä»¶
    print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£21.è¯»å–PSCNçš„è¾“å…¥graphæºæ–‡ä»¶")
    time.sleep(3)
    train_file, test_file, LSI_corpus_path, LSI_corpus_path_test, graph_file_root, model_root, permission_feature_path, lsi_fearue_file, lsi_fearue_file_test = get_graph_config(dataset)

    # é€‰æ‹©æ˜¯å¦ä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œ22å’Œ23æ­¥
    use_pool = False

    if not use_pool:
        print("â€¼ï¸â—â€¼ï¸â—â€¼ï¸â—â€¼ï¸â—ä¸ä½¿ç”¨è¿›ç¨‹æ± ")
        # 22.ç”Ÿæˆè®­ç»ƒé›†çš„graphæ–‡ä»¶
        print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£22.ç”Ÿæˆè®­ç»ƒé›†çš„graphæ–‡ä»¶")
        time.sleep(5)
        create_graph_files(train_file, graph_file_root, LSI_corpus_path, model_root, lsi_fearue_file, permission_feature_path=permission_feature_path, type='cscg', apktool_root_path=apktool_root_path, add_root=False)
        # pool.apply_async(create_graph_files, (train_file, graph_file_root, LSI_corpus_path, model_root, lsi_fearue_file, permission_feature_path, 'cscg', apktool_root_path, False))

        # 23.ç”Ÿæˆæµ‹è¯•é›†çš„graphæ–‡ä»¶
        print("ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£23.ç”Ÿæˆæµ‹è¯•é›†çš„graphæ–‡ä»¶")
        time.sleep(5)
        create_graph_files(test_file, graph_file_root, LSI_corpus_path_test, model_root, lsi_fearue_file_test, permission_feature_path=permission_feature_path, type='cscg',  apktool_root_path=apktool_root_path)
        # pool.apply_async(create_graph_files, (test_file, graph_file_root, LSI_corpus_path_test, model_root, lsi_fearue_file_test, permission_feature_path, 'cscg', apktool_root_path, False))
        # pool.close()
        # pool.join()  
        # # czc: å¦‚æœä½¿ç”¨è¿›ç¨‹æ± ï¼šè¿™é‡Œç”Ÿæˆè®­ç»ƒé›†å’Œç”Ÿæˆæµ‹è¯•é›†åŒæ—¶å¼€å§‹äº†ï¼Œ
        # # åˆ°åé¢ç”±äºæµ‹è¯•é›†æ•°é‡å°‘æå‰ç”Ÿæˆå®Œæ¯•ç»“æŸï¼Œç„¶åè®­ç»ƒé›†çš„ç”Ÿæˆä¹ŸåŒæ—¶ç»“æŸï¼Œä½†æ­¤æ—¶è®­ç»ƒé›†å¹¶æ²¡æœ‰ç”Ÿæˆå®Œæ¯•
        # # è®­ç»ƒé›†æå‰ç»“æŸæ˜¯å› ä¸ºæŸä¸ªxmlæœ‰é—®é¢˜å¯¼è‡´é”™è¯¯æ‰€ä»¥è¿›ç¨‹åœæ­¢ï¼Œä½†æ˜¯æµ‹è¯•é›†è¿˜åœ¨ç”Ÿæˆï¼Œæ‰€ä»¥é€ æˆè¿™ä¸ªç°è±¡

    else:
        print("â€¼ï¸â—â€¼ï¸â—â€¼ï¸â—â€¼ï¸â—ä½¿ç”¨è¿›ç¨‹æ± ")
        # ä½¿ç”¨è¿›ç¨‹æ± è¿›è¡Œ22å’Œ23æ­¥
        time.sleep(5)
        pool = Pool(processes=2)
        pool.apply_async(create_graph_files, (train_file, graph_file_root, LSI_corpus_path, model_root, lsi_fearue_file, permission_feature_path, 'cscg', apktool_root_path, False))
        create_graph_files(test_file, graph_file_root, LSI_corpus_path_test, model_root, lsi_fearue_file_test, permission_feature_path=permission_feature_path, type='cscg',  apktool_root_path=apktool_root_path)
        pool.close()
        pool.join()

# åŸºäºjavaæ–‡çš„importå…³ç³»è¿›è¡Œå›¾æ„å»ºï¼Œç›¸å½“äºpublic classçš„è°ƒç”¨å…³ç³»ï¼Œå¹¶ä¿ç•™ä¸€å®šçš„3rdåº“ï¼Œä½¿å¾—è¿‡æ»¤åèŠ‚ç‚¹æ•°é‡å°äº100çš„ï¼Œå°½é‡è¡¥å……åˆ°æ¥è¿‘100
@fun_timer_dict(function_run_time_dict)
def class_set_call_graph_test(dataset):
    # 12.è¯»å–PSCNçš„è¾“å…¥graphæºæ–‡ä»¶
    # czc-cursorï¼šPSCHæ˜¯public classçš„è°ƒç”¨å…³ç³»ï¼Œå¹¶ä¿ç•™ä¸€å®šçš„3rdåº“ï¼Œä½¿å¾—è¿‡æ»¤åèŠ‚ç‚¹æ•°é‡å°äº100çš„ï¼Œå°½é‡è¡¥å……åˆ°æ¥è¿‘100
    train_file, test_file, LSI_corpus_path, LSI_corpus_path_test, graph_file_root, \
    model_root, permission_feature_path, lsi_fearue_file, lsi_fearue_file_test = get_graph_config(dataset)

    # 15.graph_netè®­ç»ƒæµ‹è¯•
    graph_model(model_root, dataset)  # è®­ç»ƒå’Œæµ‹è¯•, è®­ç»ƒå’Œæµ‹è¯•çš„æ¨¡å‹æ–‡ä»¶éƒ½ä¿å­˜åœ¨model_rootç›®å½•ä¸‹


@fun_timer_dict(function_run_time_dict)
def main():
    dataset = get_dataset_name()  # ä»é…ç½®pyè·å–æ•°æ®é›†åç§°

    # é€‰æ‹©å…¨æµç¨‹æ‰§è¡Œæˆ–è€…å•ä¸ªå‡½æ•°æ‰§è¡Œ
    select = int(input("ğŸ”è¯·é€‰æ‹©æ‰§è¡Œçš„æ­¥éª¤ï¼š\n\
        1. å…¨æµç¨‹æ‰§è¡Œ\n\
        2. å•ä¸ªå‡½æ•°æ‰§è¡Œ\n"))
    if select == 1:  # å…¨æµç¨‹æ‰§è¡Œ
        # 2.py å¯¹åŸå§‹APKæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬åç¼–è¯‘ç­‰ï¼Œæº2.py
        preproces(dataset)  

        # 3.py ä»…ä½¿ç”¨è¯­ä¹‰æ¨¡å‹å’Œpermissionç‰¹å¾è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œæº3.py
        lsi_model_train(dataset)  

        # 4.py åŸºäºjavaæ–‡ä»¶çš„importå…³ç³»è¿›è¡Œå›¾æ„å»ºï¼Œç›¸å½“äºpublic classçš„è°ƒç”¨å…³ç³»ï¼Œ
        # å¹¶ä¿ç•™ä¸€å®šçš„3rdåº“ï¼Œä½¿å¾—è¿‡æ»¤åèŠ‚ç‚¹æ•°é‡å°äº100çš„ï¼Œå°½é‡è¡¥å……åˆ°æ¥è¿‘100ï¼Œæº4.py
        class_set_call_graph(dataset)  

        # 5.py åŸºäºjavaæ–‡çš„importå…³ç³»è¿›è¡Œå›¾æ„å»ºï¼Œç›¸å½“äºpublic classçš„è°ƒç”¨å…³ç³»ï¼Œ
        # å¹¶ä¿ç•™ä¸€å®šçš„3rdåº“ï¼Œä½¿å¾—è¿‡æ»¤åèŠ‚ç‚¹æ•°é‡å°äº100çš„ï¼Œå°½é‡è¡¥å……åˆ°æ¥è¿‘100ï¼Œæº5.py
        class_set_call_graph_test(dataset)  
    elif select == 2:  # å•ä¸ªé€‰æ‹©å‡½æ•°æ‰§è¡Œ
        # é€‰æ‹©æ‰§è¡Œçš„å‡½æ•°
        function_select = int(input("ğŸ”è¯·é€‰æ‹©æ‰§è¡Œçš„å‡½æ•°ï¼š\n\
            1. preprocesï¼šå¯¹åŸå§‹APKæ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬åç¼–è¯‘ç­‰\n\
            2. lsi_model_trainï¼šä»…ä½¿ç”¨è¯­ä¹‰æ¨¡å‹å’Œpermissionç‰¹å¾è¿›è¡Œæ¨¡å‹è®­ç»ƒ\n\
            3. class_set_call_graph\n\
            4. class_set_call_graph_test\n"))
        if function_select == 1:
            preproces(dataset)
        elif function_select == 2:
            lsi_model_train(dataset)
        elif function_select == 3:
            class_set_call_graph(dataset)
        elif function_select == 4:
            class_set_call_graph_test(dataset)
    else:
        print("ğŸ”è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥")

if __name__ == '__main__':
    main()
    for function_name, run_time in function_run_time_dict.items():
        print(f"ğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ªğŸ¤ª{function_name} è¿è¡Œæ—¶é—´: {run_time:.2f} ç§’")
